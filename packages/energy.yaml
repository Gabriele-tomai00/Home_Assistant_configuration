template:
  - sensor:

      #################################################
      #######       GENERAL                      ######
      #################################################

      - name: "imported power"
        unique_id: imported_power
        unit_of_measurement: kW
        state: >-
          {{ 
            (states('sensor.prism_imported_power_kw') | float(
                states('sensor.solaredge_sensore_rete') | float(0)
            )) | round(2)
          }}
          
      #################################################
      - name: "Solar Selfconsumption Ratio"
        unique_id: solar_selfconsumption_ratio
        icon: mdi:percent-outline
        state: >
          {% if (((states('sensor.solar_panel_to_house_daily')| float(0)) + (states('sensor.solar_battery_in_daily')| float(0)) + (states('sensor.solar_exported_power_daiy')| float(0))) <= 0) %}
            0
          {% else %}
            {{((((states('sensor.solar_panel_to_house_daily')| float(0)) + (states('sensor.solar_battery_in_daily')| float(0))) / ((states('sensor.solar_panel_to_house_daily')| float(0)) + (states('sensor.solar_battery_in_daily')| float(0)) + (states('sensor.solar_exported_power_daily')| float(0)))) * 100) | round (0) }}
          {% endif %}
      - name: "Solar Autarkie Ratio"
        unique_id: solar_autarkie_ratio
        icon: mdi:percent-outline
        state: >
          {% if ((states('sensor.solar_house_consumption_daily') | float(0)) <= 0) %}
            0
          {% else %}
            {{((1 - ((states('sensor.solar_imported_power_daily') | float(0)) / (states('sensor.solar_house_consumption_daily') | float(0)))) * 100 ) | round (0)}}   
          {% endif %}

      - name: "Solar Inverter Effectiveness"
        unique_id: solar_inverter_effectiveness
        icon: mdi:percent-outline
        unit_of_measurement: "%"
        state: >
          {% if ((states('sensor.solaredge_dc_power') | float(0)) < 100) or ((states('sensor.solaredge_ac_power') | float(0)) < 100)%}
            {{(states('sensor.solar_inverter_effectiveness'))}}
          {% else %}
            {% if is_state('sensor.solar_inverter_effectiveness', 'unknown') %}
              1
            {% elif ((states('sensor.solaredge_ac_power') | float(0)) <= 0) %}
              {{(states('sensor.solar_inverter_effectiveness'))}}
            {% elif ((states('sensor.solaredge_dc_power') | float(0)) <= 0) %}
              {{(states('sensor.solar_inverter_effectiveness'))}}
            {% else %}
              {{(states('sensor.solaredge_ac_power') | float(0)) / (states('sensor.solaredge_dc_power') | float(0))}}
            {% endif %}
          {% endif %}

      - name: "Solar Battery Effectiveness"
        unique_id: solar_battery_effectiveness
        icon: mdi:percent-outline
        unit_of_measurement: "%"
        state: >
          {% if (((states('sensor.solaredge_dc_power') | float(0)) + (states('sensor.solaredge_battery1_power') | float(0))) <= 0 ) %}
            {% if ((states('sensor.solaredge_battery1_power')| float(0)) >= 0) %}
              {{(states('sensor.solar_battery_effectiveness'))}}
            {% elif ((states('sensor.solaredge_dc_power') | float(0)) <= 0) %}
              {{(states('sensor.solar_battery_effectiveness'))}}  
            {% else %}
              {{1 - ((((states('sensor.solaredge_battery1_power') | float(0)) * -1) - (states('sensor.solaredge_dc_power') | float(0))) /  ((states('sensor.solaredge_battery1_power') | float(0)) * -1))}}
            {% endif %} 
          {% elif is_state('sensor.solar_battery_effectiveness', 'unknown') or is_state('sensor.solar_battery_effectiveness', 'unavailable')  %}
            1
          {% elif is_state('sensor.solar_battery_effectiveness', 0) %}
            1
          {% else %}
            {{(states('sensor.solar_battery_effectiveness'))}}
          {% endif %}

      - name: "Solar Panel Production W"
        unique_id: solar_panel_production_w
        unit_of_measurement: "W"
        icon: mdi:solar-power
        state: >
          {% if ((states('sensor.solaredge_dc_power') | float(0)) + (states('sensor.solaredge_battery1_power') | float(0)) <= 0) %}
            0
          {% elif (is_state('sensor.solaredge_dc_power', 'unknown')) or (is_state('sensor.solaredge_battery1_power', 'unknown'))%}
            0
          {% else %}
            {{((states('sensor.solaredge_dc_power') | float(0)) + (states('sensor.solaredge_battery1_power') | float(0)))}}
          {% endif %}

      - name: "Solar Panel To House W"
        unique_id: solar_panel_to_house_w
        unit_of_measurement: "W"
        icon: mdi:solar-power
        state: >
          {% if ((states('sensor.solaredge_battery1_power') | float(0)) >= 0) and ((states('sensor.solaredge_m1_ac_power') | float(0)) > 0) %}
            {{(states('sensor.solaredge_ac_power') | float(0) - states('sensor.solaredge_m1_ac_power') | float(0))}}
          {% elif ((states('sensor.solaredge_battery1_power') | float(0)) >= 0) and ((states('sensor.solaredge_m1_ac_power') | float(0)) < 0) %}
            {{states('sensor.solaredge_ac_power') | float(0)}}
          {% elif ((states('sensor.solaredge_battery1_power') | float(0)) < 0)%}
            {% if ((states('sensor.solaredge_dc_power') | float(0) + states('sensor.solaredge_battery1_power') | float(0)) < 0 ) %}
              0
            {% else %}
              {{((states('sensor.solaredge_dc_power') | float(0)) + (states('sensor.solaredge_battery1_power') | float(0))) * (states('sensor.solar_inverter_effectiveness') | float(0))}}
            {% endif %}   
          {% else %}
            0
          {% endif %}

      - name: "Solar Grid To House W"
        unique_id: solar_grid_to_house_w
        unit_of_measurement: "W"
        icon: mdi:transmission-tower-export
        state: >
          {% if ((states('sensor.solaredge_m1_ac_power') | float(0)) <= 0) %}
            {{((states('sensor.solaredge_m1_ac_power') | float(0)) *-1)}}
          {% else %}
            0
          {% endif %}

      - name: "Solar Panel To Grid W"
        unique_id: solar_panel_to_grid_w
        unit_of_measurement: "W"
        icon: mdi:solar-power
        state: >
          {% if ((states('sensor.solaredge_m1_ac_power') | float(0)) > 0) %}
            {{(states('sensor.solaredge_m1_ac_power') | float(0))}}
          {% else %}
            0
          {% endif %}

      - name: "Solar Battery To House W"
        unique_id: solar_battery_to_house_w
        unit_of_measurement: "W"
        icon: mdi:battery-negative
        state: >
          {% if ((states('sensor.solaredge_battery1_power') | float(0)) < 0) %}
            {{((states('sensor.solaredge_battery1_power') | float(0)) * -1) * (states('sensor.solar_battery_effectiveness')| float(0)) * (states('sensor.solar_inverter_effectiveness')| float(0))}}
          {% else %}
            0
          {% endif %}

      - name: "Solar Panel To Battery W"
        unique_id: solar_panel_to_battery_w
        unit_of_measurement: "W"
        icon: mdi:solar-power
        state: >
          {% if ((states('sensor.solaredge_battery1_power') | float(0)) > 0) %}
            {% if ((states('sensor.solar_grid_to_battery_w') | float(0)) > 0) %}
              0
            {% else %}
              {{(states('sensor.solaredge_battery1_power') | float(0))}}
            {% endif %} 
          {% else %}
            0
          {% endif %}

      - name: "Solar Grid To Battery W"
        unique_id: solar_grid_to_battery_w
        unit_of_measurement: "W"
        icon: mdi:battery-positive
        state: >
          {% if (is_state('sensor.solaredge_ac_power', '0')) and ((states('sensor.solaredge_battery1_power') | float(0)) > 0) %}
            {{(states('sensor.solaredge_battery1_power') | float(0))}}
          {% else %}
            0
          {% endif %}

      - name: "Solar Battery In W"
        unique_id: solar_battery_in_w
        unit_of_measurement: "W"
        icon: mdi:battery-positive
        state: >
          {{(states('sensor.solar_grid_to_battery_w') | float(0)) + (states('sensor.solar_panel_to_battery_w') | float(0))}}

      - name: "Solar House Consumption W"
        unique_id: solar_house_consumption_w
        unit_of_measurement: "W"
        icon: mdi:home
        state: >
          {{(states('sensor.solar_panel_to_house_w') | float(0)) + (states('sensor.solar_battery_to_house_w') | float(0)) + (states('sensor.solar_grid_to_house_w') | float(0))}}

      - name: "Solar Imported Power W"
        unique_id: solar_imported_power_w
        unit_of_measurement: "W"
        icon: mdi:transmission-tower-export
        state: >
          {% if ((states('sensor.solaredge_m1_ac_power') | float(0)) <= 0) %}
            {{((states('sensor.solaredge_m1_ac_power') | float(0)) *-1)}}
          {% else %}
            0
          {% endif %}

      - name: "Solar Exported Power W"
        unique_id: solar_exported_power_w
        unit_of_measurement: "W"
        icon: mdi:transmission-tower-import
        state: >
          {% if ((states('sensor.solaredge_m1_ac_power') | float(0)) > 0) %}
            {{(states('sensor.solaredge_m1_ac_power') | float(0))}}
          {% else %}
            0
          {% endif %}

      - name: "Solar Lifetime Production"
        unique_id: solar_lifetime_production
        unit_of_measurement: "MWh"
        icon: mdi:solar-power
        state: >
          {{(((states('sensor.solaredge_ac_energy_kwh') | float(0)) / 1000) | round (2))}}

      #################################################
      #######       FORECAST SOLAR PRODUCTION    ######
      #################################################

      - name: solaredge_grid_sensor
        unique_id: solaredge_grid_sensor_kw
        unit_of_measurement: kW
        icon: mdi:transmission-tower-export
        state: "{{ (states('sensor.solaredge_m1_ac_power') | float(0) / 1000) | round(2) }}"

      - name: solar_panel_production_kw
        unit_of_measurement: kW
        icon: mdi:solar-power
        state: "{{ (states('sensor.solar_panel_production_w') | float(0) / 1000) | round(2) }}"

      - name: solar_panel_to_house_kw
        unit_of_measurement: kW
        icon: mdi:solar-power
        state: "{{ (states('sensor.solar_panel_to_house_w') | float(0) / 1000) | round(2) }}"

      - name: solar_grid_to_house_kw
        unit_of_measurement: kW
        icon: mdi:transmission-tower-export
        state: "{{ (states('sensor.solar_grid_to_house_w') | float(0) / 1000) | round(2) }}"

      - name: solar_panel_to_grid_kw
        unit_of_measurement: kW
        icon: mdi:solar-power
        state: "{{ (states('sensor.solar_panel_to_grid_w') | float(0) / 1000) | round(2) }}"

      - name: solar_battery_to_house_kw
        unit_of_measurement: kW
        icon: mdi:battery-negative
        state: "{{ (states('sensor.solar_battery_to_house_w') | float(0) / 1000) | round(2) }}"

      - name: solar_panel_to_battery_kw
        unit_of_measurement: kW
        icon: mdi:solar-power
        state: "{{ (states('sensor.solar_panel_to_battery_w') | float(0) / 1000) | round(2) }}"

      - name: solar_grid_to_battery_kw
        unit_of_measurement: kW
        icon: mdi:battery-positive
        state: "{{ (states('sensor.solar_grid_to_battery_w') | float(0) / 1000) | round(2) }}"

      - name: solar_battery_in_kw
        unit_of_measurement: kW
        icon: mdi:battery-positive
        state: "{{ (states('sensor.solar_battery_in_w') | float(0) / 1000) | round(2) }}"

      - name: solar_house_consumption_kw
        unit_of_measurement: kW
        icon: mdi:home
        state: "{{ (states('sensor.solar_house_consumption_w') | float(0) / 1000) | round(2) }}"

      - name: solar_imported_power_kw
        unit_of_measurement: kW
        icon: mdi:transmission-tower-export
        state: "{{ (states('sensor.solar_imported_power_w') | float(0) / 1000) | round(2) }}"

      - name: solar_exported_power_kw
        unit_of_measurement: kW
        icon: mdi:transmission-tower-import
        state: "{{ (states('sensor.solar_exported_power_w') | float(0) / 1000) | round(2) }}"

      # SOLAREDGE
      - name: "solaredge_potenza_totale_dc"
        unique_id: solaredge_potenza_totale_dc
        unit_of_measurement: kW
        state: >-
          {% set produzione_fv_dc = ((((states('sensor.solaredge_dc_power'))|float) + (states('sensor.solaredge_battery1_power')|float))/1000)|round(2) %}
          {% if produzione_fv_dc < 0.1 %}
            0
          {% elif (now().hour <= 5) or (now().hour >= 21) %}
            0
          {% else %}
            {{ produzione_fv_dc }}
          {% endif %}

      - name: "produzione_quotidiana_fv_dc_kwh"
        unique_id: produzione_quotidiana_fv_dc_kwh
        unit_of_measurement: kWh
        state: >-
          {% if states('sensor.solar_panel_production_daily') | float > 20 %}
            {{ states('sensor.solar_panel_production_daily') | round(1) }}
          {% elif states('sensor.solar_panel_production_daily') | float > 1 %}
            {{ states('sensor.solar_panel_production_daily') | round(2) }}
          {% else %}
            {{ states('sensor.solar_panel_production_daily') }}
          {% endif %}

      - name: "consumo_casa"
        unique_id: consumo_casa
        unit_of_measurement: kW
        state: >-
          {% set consumo_c = (
              (states('sensor.solaredge_ac_power') | float(0) / 1000)
              + (states('sensor.prism_imported_power_kw') | float(0))
            ) | round(2) %}
          {% if consumo_c <= 0 %}
            0
          {% else %}
            {{ consumo_c }}
          {% endif %}

      - name: "consumo_casa_no_auto"
        unique_id: consumo_casa_no_auto
        unit_of_measurement: kW
        state: "{{ ((states('sensor.consumo_casa')|float - states('sensor.prism_power_kw')|float)|float(2))|round(2) }}"

      - name: "eccedenza_fotovotlaico"
        unique_id: eccedenza_fotovotlaico
        unit_of_measurement: kW
        state: >-
          {% set eccedenza_totale = (states('sensor.lg_carica_istantanea_kw')|float + states('sensor.solar_exported_power_kw')|float)|round(2) %}
          {% set eccedenza_massima_possibile_ac = (6 - (states('sensor.consumo_casa')|float))|round(2) %}
          {% if (states('sensor.solaredge_potenza_totale_dc')|float == 0) or (eccedenza_massima_possibile_ac < 0) %}
            0
          {% elif (eccedenza_totale > eccedenza_massima_possibile_ac) and (eccedenza_massima_possibile_ac >= 0) %}
            {{ eccedenza_massima_possibile_ac }}
          {% elif (eccedenza_totale > eccedenza_massima_possibile_ac) and (eccedenza_massima_possibile_ac < 0) %}
            0
          {% else %}
            {{ eccedenza_totale }}
          {% endif %}

      - name: "solaredge_sensore_rete"
        unique_id: solaredge_sensore_rete
        unit_of_measurement: kW
        state: >-
          {% set value = float((states('sensor.solaredge_m1_ac_power')|float /1000) | round(2)) %}
          {% if ((value >= 0 and value < 0.02) or (value < 0 and value > -0.04)) %}
            0
          {% else %}
            {{ -value }}
          {% endif %}

      # LG BATTERY
      - name: "lg_carica_scarica_istantanea_kw"
        unique_id: lg_carica_scarica_istantanea_kw
        unit_of_measurement: kW
        state: "{{ (states('sensor.solaredge_battery1_power')|float/1000)|round(2) }}"

      - name: "lg_carica_istantanea_kw"
        unique_id: lg_carica_istantanea_kw
        unit_of_measurement: kW
        state: >-
          {% if states('sensor.solaredge_battery1_power') | float > 0 %}
            {{ (states('sensor.solaredge_battery1_power')|float/1000)|round(1) }}
          {% else %}
            0
          {% endif %}

      - name: "lg_scarica_istantanea_kw"
        unique_id: lg_scarica_istantanea_kw
        unit_of_measurement: kW
        state: >-
          {% if states('sensor.solaredge_battery1_power') | float < 0 %}
            {{ -(states('sensor.solaredge_battery1_power')|float/1000)|round(1) }}
          {% else %}
            0
          {% endif %}

      - name: "lg_percentuale_di_carica"
        unique_id: lg_percentuale_di_carica
        unit_of_measurement: "%"
        state: >-
          {% set raw_soc = states('sensor.solaredge_battery1_state_of_charge') %}
          {% set charge_kw = states('sensor.lg_carica_istantanea_kw') %}
          {% set discharge_kw = states('sensor.lg_scarica_istantanea_kw') %}
          {% if raw_soc | lower in ['unknown', 'unavailable', 'none', ''] or
                charge_kw | lower in ['unknown', 'unavailable', 'none', ''] or
                discharge_kw | lower in ['unknown', 'unavailable', 'none', ''] %}
            {{ states('sensor.lg_percentuale_di_carica') }}
          {% else %}
            {% set percentuale = (raw_soc | float(0)) | round(0) %}
            {% set percentualeCalcolata = ((percentuale - 5) * (100 / (100 - 5)) | float) | round(0) %}
            {% set ricaricaLG = charge_kw | float(0) %}
            {% set scaricaLG = discharge_kw | float(0) %}
            {% if percentualeCalcolata > 100 %}
              100
            {% elif percentualeCalcolata < 0 %}
              0
            {% elif percentualeCalcolata >= 99 and ricaricaLG <= 0.1 %}
              100
            {% elif percentualeCalcolata <= 1 and ricaricaLG <= 0.1 and scaricaLG <= 0.1 %}
              0
            {% elif percentualeCalcolata == 100 and ricaricaLG >= 0.1 %}
              99
            {% else %}
              {{ percentualeCalcolata }}
            {% endif %}
          {% endif %}

      # SOLAR PRODUCTION FORECAST
      - name: "energy_production_today_stable"
        unique_id: energy_production_today_stable
        unit_of_measurement: kWh
        state: >-
          {% set val = states('sensor.energy_production_today') %}
          {% if val | lower not in ['unknown', 'unavailable', 'none', ''] %}
            {{ val | float(0) | round(0) | int }}
          {% else %}
            {{ states('sensor.energy_production_today_stable') }}
          {% endif %}

      - name: "energy_production_tomorrow_stable"
        unique_id: energy_production_tomorrow_stable
        unit_of_measurement: kWh
        state: >-
          {% set val = states('sensor.energy_production_tomorrow') %}
          {% if val | lower not in ['unknown', 'unavailable', 'none', ''] %}
            {{ val | float(0) | round(0) | int }}
          {% else %}
            {{ states('sensor.energy_production_tomorrow_stable') }}
          {% endif %}

      ## altro
      - name: "boiler_consumption"
        unique_id: boiler_consumption
        unit_of_measurement: kW
        state: >-
          {% set power =  (states('sensor.shellyplug_s_4022d8895ab1_power')|float/1000)|round(2) %}
          {% if ( power <= 0.5 ) %}
            0
          {% else %}
            {{ power }}
          {% endif %}

      - name: "generation_fv_to_house"
        unique_id: generation_fv_to_house
        unit_of_measurement: kW
        state: >-
          {{
            (
              states('sensor.solaredge_potenza_totale_dc')|float(0)
              - states('sensor.immissione_rete')|float(0)
              - states('sensor.lg_carica_istantanea_kw')|float(0)
            ) | round(2)
          }}

sensor:
  - platform: integration
    source: sensor.solar_panel_production_w
    method: left
    unit_prefix: k
    name: solar_panel_production_kwh
  - platform: integration
    source: sensor.solar_battery_to_house_w
    method: left
    unit_prefix: k
    name: solar_battery_out_kwh
  - platform: integration
    source: sensor.solar_battery_in_w
    method: left
    unit_prefix: k
    name: solar_battery_in_kwh
  - platform: integration
    source: sensor.solar_house_consumption_w
    method: left
    unit_prefix: k
    name: solar_house_consumption_kwh
  - platform: integration
    source: sensor.solar_imported_power_w
    method: left
    unit_prefix: k
    name: solar_imported_power_kwh
  - platform: integration
    source: sensor.solar_exported_power_w
    method: left
    unit_prefix: k
    name: solar_exported_power_kwh
  - platform: integration
    source: sensor.solar_panel_to_house_w
    method: left
    unit_prefix: k
    name: solar_panel_to_house_kwh

  - platform: statistics
    name: "Solar Battery Effectiveness Average"
    unique_id: solar_battery_effectiveness_average
    state_characteristic: mean
    sampling_size: 1200
    max_age:
      hours: 24
    entity_id: sensor.solar_battery_effectiveness

  - platform: statistics
    name: "Solar Inverter Effectiveness Average"
    unique_id: solar_inverter_effectiveness_average
    state_characteristic: mean
    sampling_size: 1200
    max_age:
      hours: 24
    entity_id: sensor.solar_inverter_effectiveness

utility_meter:
  solar_panel_production_daily:
    source: sensor.solar_panel_production_kwh
    name: Solar Panel Production Daily
    cycle: daily
  solar_battery_in_daily:
    source: sensor.solar_battery_in_kwh
    name: Solar Battery In Daily
    cycle: daily
  solar_battery_out_daily:
    source: sensor.solar_battery_out_kwh
    name: Solar Battery Out Daily
    cycle: daily
  solar_house_consumption_daily:
    source: sensor.solar_house_consumption_kwh
    name: Solar House Consumption Daily
    cycle: daily
  solar_imported_power_daily:
    source: sensor.solar_imported_power_kwh
    name: Solar Imported Power Daily
    cycle: daily
  solar_imported_power_daily_solaredge:
    source: sensor.solaredge_m1_imported_kwh
    name: Solar Imported Power Daily Solar Edge
    cycle: daily
  solar_exported_power_daily:
    source: sensor.solar_exported_power_kwh
    name: Solar Exported Power Daily
    cycle: daily
  solar_panel_to_house_daily:
    source: sensor.solar_panel_to_house_kwh
    name: Solar Panel To House Daily
    cycle: daily

  solar_panel_to_house_weekly:
    source: sensor.solar_panel_to_house_kwh
    name: Solar Panel To House Weekly
    cycle: weekly
  solar_imported_power_weekly:
    source: sensor.solar_imported_power_kwh
    name: Solar Imported Power Weekly
    cycle: weekly
  solar_house_consumption_weekly:
    source: sensor.solar_house_consumption_kwh
    name: Solar House Consumption Weekly
    cycle: weekly
  solar_panel_production_weekly:
    source: sensor.solar_panel_production_kwh
    name: Solar Panel Production Weekly
    cycle: weekly
  solar_battery_in_weekly:
    source: sensor.solar_battery_in_kwh
    name: Solar Battery In Weekly
    cycle: weekly
  solar_battery_out_weekly:
    source: sensor.solar_battery_out_kwh
    name: Solar Battery Out Weekly
    cycle: weekly
  solar_exported_power_weekly:
    source: sensor.solar_exported_power_kwh
    name: Solar Exported Power Weekly
    cycle: weekly

  solar_panel_to_house_monthly:
    source: sensor.solar_panel_to_house_kwh
    name: Solar Panel To House Monthly
    cycle: monthly
  solar_imported_power_monthly:
    source: sensor.solar_imported_power_kwh
    name: Solar Imported Power Monthly
    cycle: monthly
  solar_house_consumption_monthly:
    source: sensor.solar_house_consumption_kwh
    name: Solar House Consumption Monthly
    cycle: monthly
  solar_panel_production_monthly:
    source: sensor.solar_panel_production_kwh
    name: Solar Panel Production Monthly
    cycle: monthly
  solar_battery_in_monthly:
    source: sensor.solar_battery_in_kwh
    name: Solar Battery In Monthly
    cycle: monthly
  solar_battery_out_monthly:
    source: sensor.solar_battery_out_kwh
    name: Solar Battery Out Monthly
    cycle: monthly
  solar_exported_power_monthly:
    source: sensor.solar_exported_power_kwh
    name: Solar Exported Power Monthly
    cycle: monthly

  solar_panel_to_house_yearly:
    source: sensor.solar_panel_to_house_kwh
    name: Solar Panel To House Yearly
    cycle: yearly
  solar_imported_power_yearly:
    source: sensor.solar_imported_power_kwh
    name: Solar Imported Power Yearly
    cycle: yearly
  solar_house_consumption_yearly:
    source: sensor.solar_house_consumption_kwh
    name: Solar House Consumption Yearly
    cycle: yearly
  solar_panel_production_yearly:
    source: sensor.solar_panel_production_kwh
    name: Solar Panel Production Yearly
    cycle: yearly
  solar_battery_in_yearly:
    source: sensor.solar_battery_in_kwh
    name: Solar Battery In Yearly
    cycle: yearly
  solar_battery_out_yearly:
    source: sensor.solar_battery_out_kwh
    name: Solar Battery Out Yearly
    cycle: yearly
  solar_exported_power_yearly:
    source: sensor.solar_exported_power_kwh
    name: Solar Exported Power Yearly
    cycle: yearly
